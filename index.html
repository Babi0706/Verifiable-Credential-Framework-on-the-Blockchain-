<!DOCTYPE html>
<html>
<head>
  <title>Batch Certificate Registration</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    textarea {
      width: 100%;
      height: 250px;
      font-family: monospace;
      font-size: 14px;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      font-size: 16px;
    }
    table {
      margin-top: 20px;
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
      font-size: 14px;
    }
    th {
      background-color: #f2f2f2;
    }
    .success {
      color: green;
      font-weight: bold;
    }
    .fail {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Batch Certificate Registration</h1>
  <p>Paste certificate data as a JSON array:</p>
  <textarea id="certInput">[
  {
    "name": "Alice",
    "course": "Blockchain Development",
    "institution": "Tech University",
    "dateIssued": "2025-07-30"
  },
  {
    "name": "Bob",
    "course": "AI & ML",
    "institution": "OpenLearn Academy",
    "dateIssued": "2025-06-15"
  }
]</textarea>
  <br>
  <button onclick="registerAll()">Register All</button>

  <table id="resultsTable">
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Course</th>
        <th>Status</th>
        <th>Hash</th>
        <th>Transaction</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    async function registerAll() {
      const input = document.getElementById("certInput").value;
      const tableBody = document.querySelector("#resultsTable tbody");
      tableBody.innerHTML = "";

      let certificates;
      try {
        certificates = JSON.parse(input);
        if (!Array.isArray(certificates)) throw new Error();
      } catch {
        alert("Invalid JSON array. Please format correctly.");
        return;
      }

      for (let i = 0; i < certificates.length; i++) {
        const cert = certificates[i];

        // Show temporary row
        const row = tableBody.insertRow();
        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${cert.name || "-"}</td>
          <td>${cert.course || "-"}</td>
          <td>⏳ Registering...</td>
          <td>-</td>
          <td>-</td>
        `;

        try {
          const res = await fetch("http://localhost:3000/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(cert)
          });

          const result = await res.json();
          if (res.ok) {
            row.cells[3].innerHTML = `<span class="success">✅ Success</span>`;
            row.cells[4].innerText = result.hash;
            row.cells[5].innerText = result.txHash;
          } else {
            row.cells[3].innerHTML = `<span class="fail">❌ Failed</span>`;
            row.cells[4].innerText = "-";
            row.cells[5].innerText = result.error || "Unknown error";
          }
        } catch (err) {
          row.cells[3].innerHTML = `<span class="fail">❌ Error</span>`;
          row.cells[5].innerText = err.message;
        }
      }
    }
  </script>
</body>
</html>
