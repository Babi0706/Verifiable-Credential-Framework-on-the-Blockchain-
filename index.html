<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blockchain Certificate Verification</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      text-align: center;
      padding: 2rem;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    button {
      padding: 10px 25px;
      margin: 8px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    input {
      padding: 10px;
      margin: 10px;
      width: 300px;
    }

    #status {
      margin-top: 20px;
      font-weight: bold;
    }

    #issuedHashes {
      margin-top: 20px;
      text-align: left;
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
    }

    .hash-item {
      background: #eee;
      padding: 8px;
      border-radius: 5px;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>Blockchain Certificate Verification</h1>

  <button onclick="connectWallet()">üîó Connect Wallet</button>
  <p id="walletStatus">‚è≥ Not Connected</p>

  <input id="hashInput" placeholder="Enter certificate SHA-256 hash" />

  <div>
    <button onclick="issueCert()">‚úÖ Issue Certificate</button>
    <button onclick="verifyCert()">üîç Verify Certificate</button>
    <button onclick="revokeCert()">‚ùå Revoke Certificate</button>
  </div>

  <div id="status"></div>

  <h3>Issued Certificate Hashes</h3>
  <div id="issuedHashes"></div>

  <script>
    const abi = [/* your ABI goes here */];
    const contractAddress = "0x8df5b74f5aA6DF84870e9A29ED0569008A6a3733";
    let web3, contract, account, owner;

    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        try {
          const accounts = await ethereum.request({ method: "eth_requestAccounts" });
          account = accounts[0];
          document.getElementById("walletStatus").innerText = "‚úÖ Wallet Connected: " + account;
          contract = new web3.eth.Contract(abi, contractAddress);
          owner = await contract.methods.owner().call();
        } catch (err) {
          document.getElementById("walletStatus").innerText = "‚ùå Connection Failed";
          console.error(err);
        }
      } else {
        alert("Install MetaMask to use this DApp.");
      }
    }

    function getHashInput() {
      const hash = document.getElementById("hashInput").value.trim();
      if (!/^0x[0-9a-fA-F]{64}$/.test(hash)) {
        alert("‚ùå Invalid SHA-256 hash format.");
        throw new Error("Invalid hash");
      }
      return hash;
    }

    async function issueCert() {
      const hash = getHashInput();
      if (account.toLowerCase() !== owner.toLowerCase()) {
        alert("‚ùå Only the contract owner can issue certificates.");
        return;
      }
      try {
        await contract.methods.issueCertificate(hash).send({ from: account });
        document.getElementById("status").innerText = "‚úÖ Certificate Issued.";
        addToIssuedList(hash);
      } catch (e) {
        console.error("Issue error:", e);
        alert("‚ùå Error issuing certificate: " + (e?.message || ""));
      }
    }

    async function verifyCert() {
      const hash = getHashInput();
      try {
        const result = await contract.methods.verifyCertificate(hash).call();
        document.getElementById("status").innerText = result
          ? "‚úÖ Certificate is VALID."
          : "‚ùå Certificate is NOT valid.";
      } catch (e) {
        console.error("Verify error:", e);
        alert("‚ùå Verification failed.");
      }
    }

    async function revokeCert() {
      const hash = getHashInput();
      if (account.toLowerCase() !== owner.toLowerCase()) {
        alert("‚ùå Only the contract owner can revoke certificates.");
        return;
      }
      try {
        await contract.methods.revokeCertificate(hash).send({ from: account });
        document.getElementById("status").innerText = "‚ö†Ô∏è Certificate Revoked.";
      } catch (e) {
        console.error("Revoke error:", e);
        alert("‚ùå Error revoking certificate.");
      }
    }

    function addToIssuedList(hash) {
      const div = document.createElement("div");
      div.className = "hash-item";
      div.innerText = hash;
      document.getElementById("issuedHashes").prepend(div);
    }
  </script>
</body>
</html>
