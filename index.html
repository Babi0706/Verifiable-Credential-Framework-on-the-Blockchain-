<!DOCTYPE html>
<html>
<head>
  <title>Blockchain Certificate Issuer & Verifier</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial; margin: 40px; background: #f2f2f2; }
    .container { background: white; padding: 30px; border-radius: 10px; max-width: 600px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input[type="file"] { margin-top: 10px; }
    button { padding: 10px 20px; margin-top: 15px; }
    .hash, .result { margin-top: 20px; font-family: monospace; word-break: break-all; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üîê Blockchain Certificate Issuer & Verifier</h2>
    <input type="file" id="fileInput" />
    <div class="hash" id="hashOutput"></div>
    
    <button onclick="issueCertificate()">‚úÖ Issue Certificate</button>
    <button onclick="verifyCertificate()">üîç Verify Certificate</button>

    <div class="result" id="resultOutput"></div>
  </div>

  <script>
    let certHash = "";
    const contractAddress = "YOUR_CONTRACT_ADDRESS_HERE"; // Replace with your deployed address
    const contractABI = [ /* YOUR_ABI_HERE */ ]; // Replace with your ABI

    document.getElementById("fileInput").addEventListener("change", async function () {
      const file = this.files[0];
      if (!file) return;

      const arrayBuffer = await file.arrayBuffer();
      const hashBuffer = await crypto.subtle.digest("SHA-256", arrayBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      certHash = "0x" + hashHex;
      document.getElementById("hashOutput").innerText = `Certificate Hash (bytes32): ${certHash}`;
    });

    async function getContract() {
      const provider = new ethers.BrowserProvider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      const signer = await provider.getSigner();
      return new ethers.Contract(contractAddress, contractABI, signer);
    }

    async function issueCertificate() {
      if (!certHash) return alert("Please upload a certificate first.");
      const contract = await getContract();
      try {
        const tx = await contract.issueCertificate(certHash);
        await tx.wait();
        document.getElementById("resultOutput").innerText = "‚úÖ Certificate issued successfully.";
      } catch (err) {
        console.error(err);
        alert("‚ùå Error issuing certificate.");
      }
    }

    async function verifyCertificate() {
      if (!certHash) return alert("Please upload a certificate first.");
      const contract = await getContract();
      try {
        const isValid = await contract.verifyCertificate(certHash);
        document.getElementById("resultOutput").innerText = isValid
          ? "‚úÖ Certificate is valid."
          : "‚ùå Certificate is NOT valid.";
      } catch (err) {
        console.error(err);
        alert("‚ùå Error verifying certificate.");
      }
    }
  </script>
</body>
</html>
